package com.weatherapp\n\nimport android.os.Bundle\nimport android.view.View\nimport android.widget.Toast\nimport androidx.activity.viewModels\nimport androidx.appcompat.app.AppCompatActivity\nimport com.weatherapp.api.WeatherApiService\nimport com.weatherapp.databinding.ActivityMainBinding\nimport java.text.DecimalFormat\n\n/**\n * MainActivity is the primary entry point of the application. It sets up the UI,\n * observes LiveData from the WeatherViewModel, and displays weather information.\n */\nclass MainActivity : AppCompatActivity() {\n\n    // View Binding instance for easier UI element access\n    private lateinit var binding: ActivityMainBinding\n\n    // ViewModel instance, created using a factory to provide the WeatherApiService dependency\n    private val weatherViewModel: WeatherViewModel by viewModels {\n        WeatherViewModel.Factory(WeatherApiService.create())\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        binding = ActivityMainBinding.inflate(layoutInflater)\n        setContentView(binding.root)\n\n        val city = "Prague" // Default city to fetch weather for\n        binding.cityTextView.text = "Načítám počasí pro $city..."\n\n        setupObservers()\n        weatherViewModel.fetchWeather(city)\n    }\n\n    /**\n     * Sets up observers for LiveData from the ViewModel to update the UI.\n     */\n    private fun setupObservers() {\n        // Observe weatherData LiveData to update temperature and description\n        weatherViewModel.weatherData.observe(this) { weatherResponse ->\n            weatherResponse?.let {\n                binding.cityTextView.text = it.name\n                val df = DecimalFormat("#.##") // Format to two decimal places\n                binding.temperatureTextView.text = "${df.format(it.main?.temp)}°C"\n                binding.descriptionTextView.text = it.weather?.firstOrNull()?.description?.capitalize() ?: "N/A"\n                binding.errorTextView.visibility = View.GONE\n            }\n        }\n\n        // Observe isLoading LiveData to show/hide the progress bar and weather details\n        weatherViewModel.isLoading.observe(this) { isLoading ->\n            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE\n            val weatherDetailsVisibility = if (isLoading) View.GONE else View.VISIBLE\n            binding.temperatureTextView.visibility = weatherDetailsVisibility\n            binding.descriptionTextView.visibility = weatherDetailsVisibility\n            binding.cityTextView.visibility = weatherDetailsVisibility // Hide city text also while loading\n        }\n\n        // Observe errorMessage LiveData to display network or API errors\n        weatherViewModel.errorMessage.observe(this) { errorMessage ->\n            errorMessage?.let {\n                binding.errorTextView.text = it\n                binding.errorTextView.visibility = View.VISIBLE\n                binding.cityTextView.text = "Chyba" // Indicate an error in the city text\n                binding.temperatureTextView.visibility = View.GONE\n                binding.descriptionTextView.visibility = View.GONE\n                Toast.makeText(this, it, Toast.LENGTH_LONG).show() // Show a toast with the error\n            }\n        }\n    }\n}