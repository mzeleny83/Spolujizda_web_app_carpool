from flask import Blueprint, request, jsonify\nfrom . import db\nfrom .models import Book\nfrom .schemas import BookSchema\n\napi_bp = Blueprint('api', __name__)\n\nbook_schema = BookSchema()\nbooks_schema = BookSchema(many=True)\n\n@api_bp.route('/books', methods=['POST'])\ndef add_book():\n    json_data = request.get_json()\n    if not json_data:\n        return jsonify({"message": "No input data provided"}), 400\n    try:\n        # Load data into a Book model instance\n        book = book_schema.load(json_data)\n        db.session.add(book)\n        db.session.commit()\n        return jsonify(book_schema.dump(book)), 201\n    except Exception as e:\n        db.session.rollback()\n        return jsonify({"message": f"Error creating book: {e}"}), 400\n\n@api_bp.route('/books', methods=['GET'])\ndef get_books():\n    all_books = Book.query.all()\n    result = books_schema.dump(all_books)\n    return jsonify(result)\n\n@api_bp.route('/books/<int:book_id>', methods=['GET'])\ndef get_book(book_id):\n    book = Book.query.get_or_404(book_id)\n    return jsonify(book_schema.dump(book))\n\n@api_bp.route('/books/<int:book_id>', methods=['PUT'])\ndef update_book(book_id):\n    book = Book.query.get_or_404(book_id)\n    json_data = request.get_json()\n    if not json_data:\n        return jsonify({"message": "No input data provided"}), 400\n    try:\n        # Load data, validating but updating existing book instance\n        book = book_schema.load(json_data, instance=book, partial=True)\n        db.session.commit()\n        return jsonify(book_schema.dump(book))\n    except Exception as e:\n        db.session.rollback()\n        return jsonify({"message": f"Error updating book: {e}"}), 400\n\n@api_bp.route('/books/<int:book_id>', methods=['DELETE'])\ndef delete_book(book_id):\n    book = Book.query.get_or_404(book_id)\n    db.session.delete(book)\n    db.session.commit()\n    return '', 204\n